<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cluster a new dataset by FCMm • FCMm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Cluster a new dataset by FCMm">
<meta property="og:description" content="FCMm">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FCMm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Assessment.html">Algorithms assessment via cluster</a>
    </li>
    <li>
      <a href="../articles/Builtin_centrodis.html">Usage of the built in centroids by FCMm</a>
    </li>
    <li>
      <a href="../articles/Cluster_new_data.html">Cluster a new dataset by FCMm</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bishun945/FCMm/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Cluster_new_data_files/header-attrs-2.5/header-attrs.js"></script><link href="Cluster_new_data_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="Cluster_new_data_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cluster a new dataset by FCMm</h1>
                        <h4 class="author">Shun Bi</h4>
            
            <h4 class="date">2021-02-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bishun945/FCMm/blob/master/vignettes/Cluster_new_data.Rmd"><code>vignettes/Cluster_new_data.Rmd</code></a></small>
      <div class="hidden name"><code>Cluster_new_data.Rmd</code></div>

    </div>

    
    
<div id="preparing-the-data-set" class="section level1">
<h1 class="hasAnchor">
<a href="#preparing-the-data-set" class="anchor"></a>Preparing the data set</h1>
<p>This vignette shows the usage of the package <code>FCMm</code> for determining the cluster number (if <code>FCM</code> selected) and for training the centroids and memberships depending on input data. Here we use our demo data <code>Nechad2015</code> (resampled to <code>100</code> in number for saving vignettes building time).</p>
<p><strong>Note</strong>: we also need some other packages to facilitate our process and plot.</p>
<div id="data-pre-process" class="section level2">
<h2 class="hasAnchor">
<a href="#data-pre-process" class="anchor"></a>Data pre-process</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bishun945/FCMm">FCMm</a></span><span class="op">)</span>      <span class="co"># this package required for functions of FCMm</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>   <span class="co"># this package required for producing plots</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">magrittr</span><span class="op">)</span>  <span class="co"># this package required for pipe-operator. `vignette("magrittr")` to see more details</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org">stringr</a></span><span class="op">)</span>   <span class="co"># this package required for string operations</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"Nechad2015"</span><span class="op">)</span> <span class="co"># load the required dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Nechad2015</span><span class="op">)</span>   <span class="co"># to see the structrue of Nechad2015</span>
<span class="co">#&gt;   DataProvider SAMPLE.ID  X412.5  X442.5    X490    X510    X560    X620</span>
<span class="co">#&gt; 1         CSIR         1 0.00357 0.00413 0.00544 0.00569 0.00673 0.00238</span>
<span class="co">#&gt; 2         CSIR         2 0.00332 0.00357 0.00477 0.00517 0.00689 0.00242</span>
<span class="co">#&gt; 3         CSIR         3 0.00334 0.00388 0.00515 0.00540 0.00631 0.00220</span>
<span class="co">#&gt; 4         CSIR         4 0.00415 0.00413 0.00558 0.00651 0.00770 0.00237</span>
<span class="co">#&gt; 5         CSIR         5 0.00674 0.00674 0.00906 0.00974 0.01030 0.00278</span>
<span class="co">#&gt; 6         CSIR         6 0.00541 0.00509 0.00696 0.00788 0.01200 0.00397</span>
<span class="co">#&gt;      X665 X681.25  X708.75 X.Chl_a..ug.L. X.TSM..mg.l. CC_SITE DATE.dd.mm.yyyy.</span>
<span class="co">#&gt; 1 0.00161 0.00196 0.000913           5.14       999.99      10        7/10/2002</span>
<span class="co">#&gt; 2 0.00164 0.00235 0.001010           4.98       999.99      10        8/10/2002</span>
<span class="co">#&gt; 3 0.00146 0.00174 0.000778           3.18       999.99      10        8/10/2002</span>
<span class="co">#&gt; 4 0.00174 0.00281 0.000899           4.41       999.99      10        8/10/2002</span>
<span class="co">#&gt; 5 0.00222 0.00360 0.001010           2.91       999.99      10        9/10/2002</span>
<span class="co">#&gt; 6 0.00255 0.00367 0.001550           8.70       999.99      10       10/10/2002</span>
<span class="co">#&gt;     time latitude longitude</span>
<span class="co">#&gt; 1  08:40  -32.582    18.105</span>
<span class="co">#&gt; 2  07:00  -32.608    18.141</span>
<span class="co">#&gt; 3  09:48  -32.567    18.108</span>
<span class="co">#&gt; 4  12:15  -32.460    17.952</span>
<span class="co">#&gt; 5  11:00  -30.833    17.247</span>
<span class="co">#&gt; 6  08:08  -29.436    16.673</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">Nechad2015</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span> <span class="co"># subset Rrs data</span>
<span class="va">wv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"X"</span>,<span class="st">""</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">as.numeric</span> <span class="co"># remove the "X" character of x names (to make them numeric)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># Set this seed so that you can re-produce them</span>
<span class="va">w</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span> <span class="co"># sample some rows of the orignal data, you can test the whole set if you like</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">w</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">wv</span>

<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; [1] 150   9</span></code></pre></div>
</div>
<div id="spectra-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#spectra-plot" class="anchor"></a>Spectra plot</h2>
<p>Now Rrs dataframe (named <code>x</code>) and wavelength vector (named <code>wv</code>) are obtained and could be used for spectra plotting by using function <code><a href="../reference/plot_spec_from_df.html">plot_spec_from_df()</a></code>.</p>
<p><strong>Note</strong>: The input of <code><a href="../reference/plot_spec_from_df.html">plot_spec_from_df()</a></code> should be a matrix or data.frame with colnames that could be transformed into the numeric as the x-axis of the plot.</p>
<p>Anyway, the return of <code><a href="../reference/plot_spec_from_df.html">plot_spec_from_df()</a></code> is a <code>ggplot</code> list which means you can do anything to it if you are familiar with the package <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p.spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_spec_from_df.html">plot_spec_from_df</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">'Wavelength (nm)'</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">Rrs</span><span class="op">~</span><span class="op">(</span><span class="va">sr</span><span class="op">^</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">'none'</span>, text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p.spec</span><span class="op">)</span></code></pre></div>
<p><img src="Cluster_new_data_files/figure-html/unnamed-chunk-2-1.png" width="384" style="display: block; margin: auto;"></p>
<p>In the raw scale of Rrs, the difference between the spectra is mainly manifested as the magnitude change, especially the reflection at NIR. But it doesn’t seem that clusters could be manually detected from the spectra plot. As we all know, the difference of water color is more caused by the spectral shape rather than the magnitude, which can be seen from the trend difference from the blue region to the red. Therefore, a better way is to normalize the spectrum. Let’s look at the spectra plot of area-normalized spectral. In the following plot, it is obviously found that several clusters sharing the similar spectra shape, which is also the base of FCM running.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Here used is the function `trapz()` to normalized the raw spectra. However, if you could use the normalize function of which you like. See more details in the package `scales`.</span>
<span class="va">x.stand</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="../reference/trapz.html">trapz</a></span><span class="op">(</span><span class="va">wv</span>, <span class="va">x</span><span class="op">)</span>
<span class="va">p.spec.stand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_spec_from_df.html">plot_spec_from_df</a></span><span class="op">(</span><span class="va">x.stand</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">'Wavelength (nm)'</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">Normalized</span><span class="op">~</span><span class="va">Rrs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">'none'</span>, text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p.spec.stand</span><span class="op">)</span></code></pre></div>
<p><img src="Cluster_new_data_files/figure-html/unnamed-chunk-3-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="cluster-number-determination" class="section level2">
<h2 class="hasAnchor">
<a href="#cluster-number-determination" class="anchor"></a>Cluster number determination</h2>
<p>Before optimizing the best cluster number, we have to obtain an FD list produced by function <code><a href="../reference/FuzzifierDetermination.html">FuzzifierDetermination()</a></code> just as follow. This function is used for determining the optimal fuzzifier (or called m value) for following FCM process. The result <code>m.used</code> from the <code>FD</code> list is the desired value of Fuzzifier (m) value.</p>
<div id="generate-fd-list" class="section level3">
<h3 class="hasAnchor">
<a href="#generate-fd-list" class="anchor"></a>Generate <code>FD</code> list</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="va">FD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FuzzifierDetermination.html">FuzzifierDetermination</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">wv</span>, do.stand<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># do.stand = TRUE means the input x will be normalized in this function. </span>
<span class="co"># Otherwise, FuzzifierDetermination(x, wv, do.stand=FALSE) which means the input data will not be normalized.</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">FD</span><span class="op">)</span>
<span class="co">#&gt;          Length Class  Mode     </span>
<span class="co">#&gt; x        1350   -none- numeric  </span>
<span class="co">#&gt; x.stand  1350   -none- numeric  </span>
<span class="co">#&gt; wv          9   -none- numeric  </span>
<span class="co">#&gt; max.m       1   -none- numeric  </span>
<span class="co">#&gt; do.stand    1   -none- logical  </span>
<span class="co">#&gt; dmetric     1   -none- character</span>
<span class="co">#&gt; Area      150   -none- numeric  </span>
<span class="co">#&gt; m.ub        1   -none- numeric  </span>
<span class="co">#&gt; m.used      1   -none- numeric</span></code></pre></div>
<p><code>FD</code> list contains several result by <code><a href="../reference/FuzzifierDetermination.html">FuzzifierDetermination()</a></code>:</p>
<ul>
<li>
<em>x</em>: the raw input Rrs dataframe with unit sr^-1</li>
<li>
<em>x.stand</em>: the standardized Rrs dataframe, if <code>stand=FALSE</code>
</li>
<li>
<em>wv</em>: wavelength with unit nm</li>
<li>
<em>max.m</em>: the maximum fuzzifier of FCM as a restriction</li>
<li>
<em>stand</em>: logic value for choosing whether to use standardization</li>
<li>
<em>dmetric</em>: string value for choosing which distance metric to be used</li>
<li>
<em>Area</em>: numeric vector for trapezoidal integral values</li>
<li>
<em>m.ub</em>: the upper boundary of fuzzifier (m) value</li>
<li>
<em>m.used</em>: the desired value of fuzzifier (m) value</li>
</ul>
</div>
<div id="validate-functions-or-metrics" class="section level3">
<h3 class="hasAnchor">
<a href="#validate-functions-or-metrics" class="anchor"></a>Validate functions or metrics</h3>
<p>Here introduced are several famous cluster validate metrics such as <code>SIL.F</code>, <code>PE</code>, <code>PC</code>, and <code>MPC</code>. In brief, these metrics mean the goodness of cluster results. Except for <code>PE</code>, the larger of <code>SIL.F</code>, <code>PC</code>, and <code>MPC</code>, the better of the cluster at that time. If you are more interested in that, please see more details in the document of package <code>ppclust</code> by Zeynel Cebeci and <code>fclust</code> by Paolo Giordani. Thanks for their efforts which inspire me a lot to build the <code>FCMm</code> package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ppclust</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">fclust</span><span class="op">)</span>
<span class="va">nb_min</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">nb_max</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">idxsf</span> <span class="op">&lt;-</span> <span class="va">idxpe</span> <span class="op">&lt;-</span> <span class="va">idxpc</span> <span class="op">&lt;-</span> <span class="va">idxmpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">nb_min</span>,<span class="va">nb_max</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">for</span><span class="op">(</span><span class="va">nb</span> <span class="kw">in</span> <span class="va">nb_min</span><span class="op">:</span><span class="va">nb_max</span><span class="op">)</span><span class="op">{</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FCM.new.html">FCM.new</a></span><span class="op">(</span><span class="va">FD</span>, <span class="va">nb</span>, fast.mode<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># open the fast mode for saving time</span>
  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ppclust/man/ppclust2.html">ppclust2</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">res.FCM</span>, otype<span class="op">=</span><span class="st">"fclust"</span><span class="op">)</span>
  <span class="va">idxsf</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fclust/man/SIL.F.html">SIL.F</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">Xca</span>, <span class="va">tmp</span><span class="op">$</span><span class="va">U</span>, alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="co"># optimal with maximum value</span>
  <span class="va">idxpe</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/fclust/man/PE.html">PE</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">U</span><span class="op">)</span> <span class="co"># optimal with minimum value (NOTE I make it negative to follow with other metrics)</span>
  <span class="va">idxpc</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fclust/man/PC.html">PC</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">U</span><span class="op">)</span> <span class="co"># optimal with maximum value</span>
  <span class="va">idxmpc</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fclust/man/MPC.html">MPC</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">U</span><span class="op">)</span> <span class="co"># optimal with maximum value</span>
  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>
<span class="op">}</span>

<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>nb<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">nb_min</span>,<span class="va">nb_max</span>,<span class="fl">1</span><span class="op">)</span>,<span class="va">idxsf</span>,<span class="va">idxpe</span>,<span class="va">idxpc</span>,<span class="va">idxmpc</span><span class="op">)</span>
<span class="va">opt.num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">dt</span>,<span class="fl">2</span>,<span class="va">which.max</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">dt</span>,<span class="fl">2</span>,<span class="va">which.min</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>

<span class="va">dt</span> <span class="op">%&gt;%</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">.</span>, id<span class="op">=</span><span class="st">'nb'</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">.</span>,<span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">nb</span>,y<span class="op">=</span><span class="va">value</span>,group<span class="op">=</span><span class="va">variable</span>,color<span class="op">=</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/geom_path.html">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Cluster number"</span>, y <span class="op">=</span> <span class="st">'Metric values'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales<span class="op">=</span><span class="st">'free_y'</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">13</span><span class="op">)</span>, 
        legend.position<span class="op">=</span><span class="st">'none'</span>, 
        strip.background <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"white"</span>, color<span class="op">=</span><span class="st">"white"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Cluster_new_data_files/figure-html/unnamed-chunk-5-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nb</span> <span class="op">&lt;-</span> <span class="fl">4</span></code></pre></div>
<p>Back to the code, here we assume the best cluster number is ranging from 3 to 10 (maybe out of this range but is unusual to obtain such large number). Then we calculate every validate metrics and record them into their corresponding vectors. Finally, we will obtain the goodness curve of cluster results changing with cluster number.</p>
<p><strong>Note</strong>: the better solution to determine a cluster number is to bootstrapply sub-sample the original set, to repeat the process mentioned above for thousands times, and to decide which number is the best one. But it is quite time-consuming. For saving time, we simply selected <code>4</code> as the determined cluster number.</p>
</div>
</div>
<div id="fcm-running" class="section level2">
<h2 class="hasAnchor">
<a href="#fcm-running" class="anchor"></a>FCM running</h2>
<p>The input of the function <code><a href="../reference/FCM.new.html">FCM.new()</a></code> is a <code>FD</code> list which includes the information about the training set (normalized Rrs), the selected fuzzifier value (1.64), and also the cluster number (4).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">54321</span><span class="op">)</span> 
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FCM.new.html">FCM.new</a></span><span class="op">(</span><span class="va">FD</span>, <span class="va">nb</span>, fast.mode <span class="op">=</span> <span class="cn">TRUE</span>, do.stand <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>
<span class="co">#&gt;             Length Class   Mode   </span>
<span class="co">#&gt; FD           9     -none-  list   </span>
<span class="co">#&gt; res.FCM     17     ppclust list   </span>
<span class="co">#&gt; p.jitter     9     gg      list   </span>
<span class="co">#&gt; K            1     -none-  numeric</span>
<span class="co">#&gt; centroids    2     -none-  list   </span>
<span class="co">#&gt; plot.jitter  1     -none-  logical</span>
<span class="co">#&gt; fast.mode    1     -none-  logical</span>
<span class="va">result</span><span class="op">$</span><span class="va">p.jitter</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="Cluster_new_data_files/figure-html/unnamed-chunk-6-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Jitter plots are quite useful to inspect the cluster performance by watching the membership values assigned by each cluster. The result shows good that most of points are at bottom and top (membership equal to zero and one) which means the training set are strictly assigned to one specific cluster, avoiding too soft cluster result when using default <code>m = 2</code>. This is in line with our demand for fuzzy clustering of water spectra which finds a good compromise between the need to assign most spectra to a given cluster, and need to discriminate spectra that classify poorly.</p>
<p>The used m value is 1.64 which is less than the default 2. The reason and its benefits should be a view from the reference of package <code>FCMm</code>, i.e., Bi <em>et al.</em> (2019).</p>
<p>A <code>result</code> list contains several result by <code><a href="../reference/FCM.new.html">FCM.new()</a></code>:</p>
<ul>
<li>
<em>FD</em>: the return list by function <code><a href="../reference/FuzzifierDetermination.html">FuzzifierDetermination()</a></code>
</li>
<li>
<em>res.FCM</em>: the optimized FCM result generated by functions in package <code>ppclust</code>
</li>
<li>
<em>K</em>: cluster number</li>
<li>
<em>centroids</em>: the centroids list (both at raw and standarized scales) by aggregating spectra mean of each cluster</li>
<li>
<em>plot.jitter</em>: logic value for the option of doing jitter plot by package <code>ggplot2</code>
</li>
<li>
<em>fast.mode</em>: logic value for choosing whether to use fast mode</li>
</ul>
</div>
<div id="fcm-plotting" class="section level2">
<h2 class="hasAnchor">
<a href="#fcm-plotting" class="anchor"></a>FCM plotting</h2>
<p>This part shows how to obtain the visualization results in the package <code>FCMm</code>. Function <code><a href="../reference/plot_spec.html">plot_spec()</a></code> is used for spectral plotting the related FCM-m result.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p.spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_spec.html">plot_spec</a></span><span class="op">(</span><span class="va">result</span>, show.stand<span class="op">=</span><span class="cn">TRUE</span>, show.ribbon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p.spec</span><span class="op">$</span><span class="va">p.cluster.spec</span><span class="op">)</span></code></pre></div>
<p><img src="Cluster_new_data_files/figure-html/unnamed-chunk-7-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p.spec</span><span class="op">$</span><span class="va">p.group.spec.2</span></code></pre></div>
<p><img src="Cluster_new_data_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"> For use of function <code>plot_spec_group</code> see codes in the chunk as follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_spec_group.html">plot_spec_group</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="va">x.stand</span>,
  group <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">res.FCM</span><span class="op">$</span><span class="va">cluster</span>
<span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/labs.html">labs</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Wavelength [nm]"</span>,
       y <span class="op">=</span> <span class="st">"Normazlied Rrs"</span>,
       color <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Cluster_new_data_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="short-result-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#short-result-analysis" class="anchor"></a>Short result analysis</h2>
<p>The plot <code>Nechad2015: Normalized cluster result</code> shows great work. The normalized Rrs spectra rather than the raw were presented here since I gonna focus more on the shape of the water spectra which is mainly affected by the phytoplankton (i.e., denoted as Chla concentration). The higher the Chla concentration, the higher reflectance of water near 700 nm and the lower near-visible range (as we know the absorption of pigment will lead to the reduction of light).</p>
<p>Of course, there should be more applications of this cluster in the future, especially the accuracy, rationality, and applicability of the results, especially in the aspect of Chla concentration classification inversion. I will not repeat it here.</p>
<p>If you have any question about <code>FCMm</code>, please contact me without hesitation by email at <code>bishun1994@foxmail.com</code></p>
<p>Hope you enjoy the journey using <code>FCMm</code>!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Shun Bi, Yunmei Li.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
